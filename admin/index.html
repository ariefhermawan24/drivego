<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DriveGo - Admin</title>
    <link rel="shortcut icon" type="image/png" href="../admin/source/image/tittle-logo.png" />
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="../admin/source/css/admin.css">
</head>
<body>
    <div class="sidebar" id="sidebar">
        <div class="logo">
            <i class="icon"><img src="../admin/source/image/tittle-logo.png" alt="Logo"></i>
            <span class="logo-text"><span class="white">Drive</span><span class="orange">Go</span></span>
            <span class="toggle-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></span>
        </div>
        <ul>
            <li id="dashboard-btn"><i class="fas fa-home"></i> <span>Dashboard</span></li>
            <div class="divider"></div>
            <li onclick="toggleSubmenu(this)" class="menu-induk"><i class="fas fa-user-check"></i> <span>User Validation</span><i class="fas fa-chevron-down arrow"></i></li>
            <ul class="submenu">
                <li><i class="fas fa-info-circle"></i> <span>Rental Status</span></li>
                <li><i class="fas fa-check"></i> <span>Rent Validation</span></li>
                <li><i class="fas fa-check-circle"></i> <span>Rent Accepted</span></li>
                <li><i class="fas fa-times-circle"></i> <span>Rent Rejected</span></li>
                <li><i class="fas fa-ban"></i> <span>Rent Canceled</span></li>
            </ul>
            <div class="divider"></div>
            <li onclick="toggleSubmenu(this)" class="menu-induk"><i class="fas fa-car"></i> <span>Manage Car</span><i class="fas fa-chevron-down arrow"></i></li>
            <ul class="submenu">
                <li><i class="fas fa-car"></i> <span>Car Status</span></li>
                <li data-page="datamobil"><i class="fas fa-list"></i> <span>Car Detail</span></li>
                <li><i class="fas fa-image"></i> <span>Car Photo</span></li>
                <li><i class="fas fa-warehouse"></i> <span>Car Garage</span></li>
                <li><i class="fas fa-car-side"></i> <span>Car Type</span></li>
            </ul>
            <div class="divider"></div>
            <li onclick="toggleSubmenu(this)" class="menu-induk"><i class="fas fa-tools"></i> <span>Manage Garage</span><i class="fas fa-chevron-down arrow"></i></li>
            <ul class="submenu">
                <li><i class="fas fa-warehouse"></i> <span>Garage Detail</span></li>
            </ul>
            <div class="divider"></div>
            <li onclick="toggleSubmenu(this)" class="menu-induk"><i class="fas fa-id-badge"></i> <span>Manage Drivers</span><i class="fas fa-chevron-down arrow"></i></li>
            <ul class="submenu">
                <li><i class="fas fa-user-check"></i> <span>Driver Status</span></li>
                <li><i class="fas fa-id-card"></i> <span>Driver Details</span></li>
            </ul>
        </ul>
        <button class="toggle-btn-bottom" id="toggleBtnBottom" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>
    </div>
    <!-- Wrapper agar layout menjadi atas-bawah -->
    <div class="main-container">
        <!-- Navbar -->
        <nav class="navbar">
            <div class="navbar-center">
                <i class="fas fa-cogs"></i>
                <span>Administrator Panel</span>
            </div>
            <div class="navbar-right">
                <div class="account-dropdown">
                    <div class="user-info">
                        <span id="navbarUsername"></span>
                    </div>
                    <i class="fas fa-user-circle account-icon" onclick="toggleDropdown()"></i>
                    <div class="dropdown-content" id="accountDropdown">
                        <div class="dropdownuser-info">
                            <i class="fas fa-user-circle user-icon"></i>
                            <div class="user-details">
                                <span id="dropdownUsername"></span>
                                <span id="dropdownRole"></span>
                            </div>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a href="#" data-bs-toggle="modal" data-bs-target="#accountModal"><i class="fas fa-user" ></i> Detail Account</a>
                        <a class="logout" href="#"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Content -->
        <div id="content" class="content p-3">
            <h2>Welcome to DriveGo</h2>
            <p>Content goes here...</p>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2025 DriveGo. All rights reserved.</p>
        </footer>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="accountModal" tabindex="-1" aria-labelledby="accountModalLabel">
        <div class="modal-dialog">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title" id="accountModalLabel">Detail Akun</h5>
                    <span type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></span>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <i class="fas fa-user-circle fa-5x text-light"></i>
                        <h5 id="modalUsername" class="mt-2"></h5>
                        <p id="modalEmail" class="text-muted" style="color: white !important;"></p>
                    </div>
                    <hr class="border-secondary">
                    <ul class="list-group">
                        <li class="list-group-item bg-dark text-light border-secondary">
                            <strong>Role:</strong> <span id="modalRole"></span>
                        </li>
                        <li class="list-group-item bg-dark text-light border-secondary">
                            <strong>Telepon:</strong> <span id="modalTelepon"></span>
                        </li>
                        <li class="list-group-item bg-dark text-light border-secondary">
                            <strong>Pertanyaan Keamanan:</strong> <span id="modalSoal"></span>
                        </li>
                        <li class="list-group-item bg-dark text-light border-secondary">
                            <strong>Jawaban Keamanan:</strong> <span id="modalJawaban"></span>
                        </li>
                    </ul>
                </div>
                <div class="modal-footer border-secondary">
                    <div class="container">
                        <div class="row g-2 justify-content-center text-center">
                            <div class="col-12 col-sm-6">
                                <button type="button" class="btn btn-warning w-100" id="editUserBtn">
                                    <i class="fas fa-user-edit me-1"></i> Edit User
                                </button>
                            </div>
                            <div class="col-12 col-sm-6">
                                <button type="button" class="btn btn-info w-100" id="editPasswordBtn">
                                    <i class="fas fa-key me-1"></i> Edit Password
                                </button>
                            </div>
                            <div class="col-12 col-sm-6">
                                <button type="button" class="btn btn-primary w-100" id="editQuestionBtn">
                                    <i class="fas fa-question-circle me-1"></i> Edit Soal Keamanan
                                </button>
                            </div>
                            <div class="col-12 col-sm-6">
                                <button type="button" class="btn btn-danger w-100" id="logout">
                                    <i class="fas fa-sign-out-alt me-1"></i> Logout
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Tambah Mobil -->
    <div class="modal fade" id="modalTambahMobil" tabindex="1" aria-labelledby="modalTambahMobilLabel" aria-hidden="true">
        <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="modalTambahMobilLabel">Tambah Mobil</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            <form id="formTambahMobil">
                <div class="mb-3">
                <label for="namaMobil" class="form-label">Nama Mobil</label>
                <input type="text" id="namaMobil" class="form-control" required>
                </div>
                <div class="mb-3">
                <label for="merkMobil" class="form-label">Merek Mobil</label>
                <input type="text" id="merkMobil" class="form-control" required>
                </div>
                <div class="mb-3">
                <label for="statusMobil" class="form-label">Status</label>
                <select id="statusMobil" class="form-select">
                    <option value="tersedia">Tersedia</option>
                    <option value="disewa">Disewa</option>
                </select>
                </div>
                <div class="mb-3">
                <label for="hargaSewa" class="form-label">Harga Sewa</label>
                <input type="number" id="hargaSewa" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary">Simpan</button>
            </form>
            </div>
        </div>
        </div>
    </div>

    <!-- Modal Edit Mobil -->
    <div class="modal fade" id="modalEditMobil" tabindex="1" aria-labelledby="modalEditMobilLabel" aria-hidden="true">
        <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="modalEditMobilLabel">Edit Mobil</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            <form id="formEditMobil">
                <input type="hidden" id="editMobilId">
                <div class="mb-3">
                <label for="editNamaMobil" class="form-label">Nama Mobil</label>
                <input type="text" id="editNamaMobil" class="form-control" required>
                </div>
                <div class="mb-3">
                <label for="editMerkMobil" class="form-label">Merek Mobil</label>
                <input type="text" id="editMerkMobil" class="form-control" required>
                </div>
                <div class="mb-3">
                <label for="editStatusMobil" class="form-label">Status</label>
                <select id="editStatusMobil" class="form-select">
                    <option value="tersedia">Tersedia</option>
                    <option value="disewa">Disewa</option>
                </select>
                </div>
                <div class="mb-3">
                <label for="editHargaSewa" class="form-label">Harga Sewa</label>
                <input type="number" id="editHargaSewa" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
            </form>
            </div>
        </div>
        </div>
    </div>

    <script type="module" src="../admin/admin.js"> </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            async function loadPage(page) {
                const contentContainer = document.getElementById("content");
                if (!contentContainer) return;

                try {
                    const response = await fetch(`content/${page}.html`);
                    if (!response.ok) throw new Error("Page not found");
                    const html = await response.text();
                    contentContainer.innerHTML = html;

                    // Hapus script lama sebelum menambahkan yang baru
                    document.querySelectorAll("script[data-dynamic]").forEach(script => script.remove());

                    // Load CSS dinamis
                    document.querySelectorAll("link[data-dynamic]").forEach(link => link.remove());
                    const linkElement = document.createElement("link");
                    linkElement.rel = "stylesheet";
                    linkElement.href = `source/css/${page}.css`;
                    linkElement.setAttribute("data-dynamic", "true");
                    document.head.appendChild(linkElement);

                    // Load JS Dinamis dengan Import
                    try {
                        const modulePath = `./script/${page}.js`;
                        await import(modulePath + `?t=${Date.now()}`); // Mencegah cache
                    } catch (err) {
                        console.error(`Error loading script: ${page}.js`, err);
                    }

                } catch (error) {
                    contentContainer.innerHTML = "<h2>Page not found</h2>";
                }
            }

            // Fungsi navigasi halaman
            function navigateTo(page) {
                history.pushState({}, "", `?page=${page}`);
                loadPage(page);
            }

            // Event listener untuk tombol dashboard (karena tidak memiliki data-page)
            document.getElementById("dashboard-btn").addEventListener("click", function () {
                history.pushState({}, "", "?");
                loadPage("dashboard");
            });

            // Event listener untuk menu navigasi lainnya
            document.querySelectorAll("li[data-page]").forEach(li => {
                li.addEventListener("click", function () {
                    const page = this.getAttribute("data-page");
                    navigateTo(page);
                });
            });

            // Tangani perubahan history API (tombol back/forward browser)
            window.addEventListener("popstate", () => {
                const params = new URLSearchParams(window.location.search);
                const page = params.get("page") || "dashboard";
                loadPage(page);
            });

            // Muat halaman pertama kali sesuai URL atau default ke dashboard
            const initialPage = new URLSearchParams(window.location.search).get("page") || "dashboard";
            loadPage(initialPage);
        });

        function toggleSidebar() {
            let sidebar = document.getElementById("sidebar");
            sidebar.classList.toggle("minimized");

            // Reset semua submenu jika sidebar diminimized
            if (sidebar.classList.contains("minimized")) {
                let allSubmenus = document.querySelectorAll(".submenu");
                let allMenuItems = document.querySelectorAll(".sidebar ul li");
                let allArrows = document.querySelectorAll(".arrow");

                allSubmenus.forEach(submenu => {
                    submenu.style.maxHeight = null;
                    submenu.style.opacity = "0";
                });

                allMenuItems.forEach(item => {
                    item.classList.remove("active");
                });

                allArrows.forEach(arrow => {
                    arrow.style.transform = "rotate(0deg)"; // Reset panah ke bawah
                });
            }
        }

        function toggleSubmenu(element) {
            let sidebar = document.getElementById("sidebar");
            
            // Jika sidebar dalam mode minimized, buka kembali
            if (sidebar.classList.contains("minimized")) {
                sidebar.classList.remove("minimized");
            }

            let submenu = element.nextElementSibling;
            let arrow = element.querySelector(".arrow");

            // Toggle class active untuk menu utama
            element.classList.toggle("active");

            // Toggle submenu dengan efek sliding & panah animasi
            if (submenu.style.maxHeight) {
                submenu.style.maxHeight = null;
                submenu.style.opacity = "0";
                arrow.style.transform = "rotate(0deg)"; // Panah ke bawah
            } else {
                submenu.style.maxHeight = submenu.scrollHeight + "px";
                submenu.style.opacity = "1";
                arrow.style.transform = "rotate(180deg)"; // Panah ke atas
            }
        }

        function toggleDropdown() {
            let dropdown = document.getElementById("accountDropdown");

            if (dropdown.classList.contains("show")) {
                dropdown.classList.remove("show");
                dropdown.classList.add("hide");

                // Tunggu animasi selesai sebelum menyembunyikan elemen
                setTimeout(() => {
                    dropdown.style.display = "none";
                }, 300); // Sesuai durasi animasi CSS
            } else {
                dropdown.style.display = "block"; // Tampilkan dulu sebelum mulai animasi
                setTimeout(() => {
                    dropdown.classList.add("show");
                    dropdown.classList.remove("hide");
                }, 10);
            }
        }

        // Menutup dropdown jika klik di luar
        window.onclick = function(event) {
            let dropdown = document.getElementById("accountDropdown");
            if (!event.target.closest('.account-icon') && dropdown.classList.contains("show")) {
                dropdown.classList.remove("show");
                dropdown.classList.add("hide");

                setTimeout(() => {
                    dropdown.style.display = "none";
                }, 300);
            }
        };

    </script>
</body>
</html>
