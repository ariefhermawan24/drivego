<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DriveGo - drivers</title>
    <link rel="shortcut icon" type="image/png" href="../admin/source/image/tittle-logo.png" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="../drivers/source/css/drivers.css">
</head>
<body>
    <div class="sidebar" id="sidebar">
        <div class="logo">
            <i class="icon"><img src="../admin/source/image/tittle-logo.png" alt="Logo"></i>
            <span class="logo-text"><span class="white">Drive</span><span class="orange">Go</span></span>
            <span class="toggle-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></span>
        </div>
        <ul>
            <li><i class="fas fa-home"></i> <span>Dashboard</span></li>
            <div class="divider"></div>
            <li onclick="toggleSubmenu(this)" class="menu-induk"><i class="fas fa-user-check"></i> <span>User Validation</span><i class="fas fa-chevron-down arrow"></i></li>
            <ul class="submenu">
                <li><i class="fas fa-info-circle"></i> <span>Rental Status</span></li>
                <li><i class="fas fa-check"></i> <span>Rent Validation</span></li>
                <li><i class="fas fa-check-circle"></i> <span>Rent Accepted</span></li>
                <li><i class="fas fa-times-circle"></i> <span>Rent Rejected</span></li>
                <li><i class="fas fa-ban"></i> <span>Rent Canceled</span></li>
            </ul>
            <div class="divider"></div>
            <li onclick="toggleSubmenu(this)" class="menu-induk"><i class="fas fa-car"></i> <span>Manage Car</span><i class="fas fa-chevron-down arrow"></i></li>
            <ul class="submenu">
                <li><i class="fas fa-car"></i> <span>Car Status</span></li>
                <li><i class="fas fa-list"></i> <span>Car Detail</span></li>
                <li><i class="fas fa-image"></i> <span>Car Photo</span></li>
                <li><i class="fas fa-warehouse"></i> <span>Car Garage</span></li>
                <li><i class="fas fa-car-side"></i> <span>Car Type</span></li>
            </ul>
            <div class="divider"></div>
            <li onclick="toggleSubmenu(this)" class="menu-induk"><i class="fas fa-tools"></i> <span>Manage Garage</span><i class="fas fa-chevron-down arrow"></i></li>
            <ul class="submenu">
                <li><i class="fas fa-warehouse"></i> <span>Garage Detail</span></li>
            </ul>
            <div class="divider"></div>
            <li onclick="toggleSubmenu(this)" class="menu-induk"><i class="fas fa-id-badge"></i> <span>Manage Drivers</span><i class="fas fa-chevron-down arrow"></i></li>
            <ul class="submenu">
                <li><i class="fas fa-user-check"></i> <span>Driver Status</span></li>
                <li><i class="fas fa-user"></i> <span>Driver Detail</span></li>
            </ul>
        </ul>
        <button class="toggle-btn-bottom" id="toggleBtnBottom" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>
    </div>
   <!-- Wrapper agar layout menjadi atas-bawah -->
    <div class="main-container">
        <!-- Navbar -->
        <nav class="navbar">
            <div class="navbar-center">
                <i class="fas fa-cogs"></i>
                <span>Administrator Panel</span>
            </div>
            <div class="navbar-right">
                <div class="account-dropdown">
                    <i class="fas fa-user-circle account-icon" onclick="toggleDropdown()"></i>
                    <div class="dropdown-content" id="accountDropdown">
                        <a href="#"><i class="fas fa-user"></i> Detail Account</a>
                        <a class="logout" href="#"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Content -->
        <div class="content p-3">
            <h2>Welcome to DriveGo</h2>
            <p>Content goes here...</p>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2025 DriveGo. All rights reserved.</p>
        </footer>
    </div>

    
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let username = sessionStorage.getItem("username");
            let role = sessionStorage.getItem("role");

            function getQueryParam(param) {
                let urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(param);
            }

            function showToast(message, callback) {
                let overlay = document.createElement("div");
                overlay.style.position = "fixed";
                overlay.style.top = "0";
                overlay.style.left = "0";
                overlay.style.width = "100%";
                overlay.style.height = "100%";
                overlay.style.backdropFilter = "blur(10px)";
                overlay.style.backgroundColor = "rgba(0, 0, 0, 0.5)";
                overlay.style.zIndex = "1000";
                document.body.appendChild(overlay);

                let toast = document.createElement("div");
                toast.innerText = message;
                toast.style.position = "fixed";
                toast.style.top = "50%";
                toast.style.left = "50%";
                toast.style.transform = "translate(-50%, -50%)";
                toast.style.backgroundColor = "#333";
                toast.style.color = "#fff";
                toast.style.padding = "12px 20px";
                toast.style.borderRadius = "8px";
                toast.style.fontSize = "16px";
                toast.style.zIndex = "1100";
                toast.style.display = "flex";
                toast.style.justifyContent = "center";
                toast.style.alignItems = "center";
                toast.style.textAlign = "center";
                toast.style.maxWidth = "90%"; // Agar tetap muat di layar kecil
                document.body.appendChild(toast);

                // Responsif untuk layar kecil
                if (window.innerWidth <= 480) {
                    toast.style.fontSize = "14px";
                    toast.style.padding = "10px 15px";
                }

                setTimeout(() => {
                    document.body.removeChild(toast);
                    document.body.removeChild(overlay);
                    if (callback) callback();
                }, 2000);
            }

            function showConfirmToast(message, onConfirm) {
                let overlay = document.createElement("div");
                overlay.style.position = "fixed";
                overlay.style.top = "0";
                overlay.style.left = "0";
                overlay.style.width = "100%";
                overlay.style.height = "100%";
                overlay.style.backdropFilter = "blur(10px)";
                overlay.style.backgroundColor = "rgba(0, 0, 0, 0.5)";
                overlay.style.zIndex = "1000";
                document.body.appendChild(overlay);

                let toast = document.createElement("div");
                toast.innerHTML = `
                    <p style="margin: 0 0 10px;">${message}</p>
                    <button id="confirm-yes" style="margin-right: 10px; padding: 8px 15px; background-color: green; color: white; border: none; border-radius: 5px; cursor: pointer;">Ya</button>
                    <button id="confirm-no" style="padding: 8px 15px; background-color: red; color: white; border: none; border-radius: 5px; cursor: pointer;">Tidak</button>
                `;
                toast.style.position = "fixed";
                toast.style.top = "50%";
                toast.style.left = "50%";
                toast.style.transform = "translate(-50%, -50%)";
                toast.style.backgroundColor = "#333";
                toast.style.color = "#fff";
                toast.style.padding = "15px";
                toast.style.borderRadius = "8px";
                toast.style.textAlign = "center";
                toast.style.fontSize = "16px";
                toast.style.zIndex = "1100";
                document.body.appendChild(toast);

                document.getElementById("confirm-yes").addEventListener("click", function () {
                    document.body.removeChild(toast);
                    document.body.removeChild(overlay);
                    if (onConfirm) onConfirm();
                });

                document.getElementById("confirm-no").addEventListener("click", function () {
                    document.body.removeChild(toast);
                    document.body.removeChild(overlay);
                });
            }

            function checkSession() {
                let aksesKhusus = getQueryParam("akses");
                let username = sessionStorage.getItem("username");
                let role = sessionStorage.getItem("role");

                if (!username || !role) {
                    if (aksesKhusus === "khusus") {
                        console.log("Percobaan akses langsung terdeteksi!");
                        showToast("Akses tidak sah! Silakan login terlebih dahulu.", function () {
                            window.location.href = "../drivers-login.html";
                        });
                    } else {
                        console.log("Sesi telah berakhir, pengguna akan diarahkan ke login.");
                        showToast("Sesi telah berakhir. Silakan login kembali.", function () {
                            window.location.href = "../drivers-login.html";
                        });
                    }
                } else {
                    console.log(`User Logged In: ${username} (${role})`);
                }
            }

            checkSession();

            // Cek ulang session saat pengguna kembali ke halaman (mengatasi masalah back button)
            window.addEventListener("pageshow", function (event) {
                if (event.persisted) {
                    checkSession();
                }
            });

            // Logout event dengan konfirmasi
            document.querySelector(".logout").addEventListener("click", function (event) {
                event.preventDefault();
                showConfirmToast("Anda yakin ingin keluar?", function () {
                    sessionStorage.clear();
                    showToast("Anda telah berhasil keluar.", function () {
                        window.location.href = "../drivers-login.html";
                    });
                });
            });
        });

        function toggleSidebar() {
            let sidebar = document.getElementById("sidebar");
            sidebar.classList.toggle("minimized");

            // Reset semua submenu jika sidebar diminimized
            if (sidebar.classList.contains("minimized")) {
                let allSubmenus = document.querySelectorAll(".submenu");
                let allMenuItems = document.querySelectorAll(".sidebar ul li");
                let allArrows = document.querySelectorAll(".arrow");

                allSubmenus.forEach(submenu => {
                    submenu.style.maxHeight = null;
                    submenu.style.opacity = "0";
                });

                allMenuItems.forEach(item => {
                    item.classList.remove("active");
                });

                allArrows.forEach(arrow => {
                    arrow.style.transform = "rotate(0deg)"; // Reset panah ke bawah
                });
            }
        }

        function toggleSubmenu(element) {
            let sidebar = document.getElementById("sidebar");
            
            // Jika sidebar dalam mode minimized, buka kembali
            if (sidebar.classList.contains("minimized")) {
                sidebar.classList.remove("minimized");
            }

            let submenu = element.nextElementSibling;
            let arrow = element.querySelector(".arrow");

            // Toggle class active untuk menu utama
            element.classList.toggle("active");

            // Toggle submenu dengan efek sliding & panah animasi
            if (submenu.style.maxHeight) {
                submenu.style.maxHeight = null;
                submenu.style.opacity = "0";
                arrow.style.transform = "rotate(0deg)"; // Panah ke bawah
            } else {
                submenu.style.maxHeight = submenu.scrollHeight + "px";
                submenu.style.opacity = "1";
                arrow.style.transform = "rotate(180deg)"; // Panah ke atas
            }
        }

        function toggleDropdown() {
            let dropdown = document.getElementById("accountDropdown");

            if (dropdown.classList.contains("show")) {
                dropdown.classList.remove("show");
                dropdown.classList.add("hide");

                // Tunggu animasi selesai sebelum menyembunyikan elemen
                setTimeout(() => {
                    dropdown.style.display = "none";
                }, 300); // Sesuai durasi animasi CSS
            } else {
                dropdown.style.display = "block"; // Tampilkan dulu sebelum mulai animasi
                setTimeout(() => {
                    dropdown.classList.add("show");
                    dropdown.classList.remove("hide");
                }, 10);
            }
        }

        // Menutup dropdown jika klik di luar
        window.onclick = function(event) {
            let dropdown = document.getElementById("accountDropdown");
            if (!event.target.closest('.account-icon') && dropdown.classList.contains("show")) {
                dropdown.classList.remove("show");
                dropdown.classList.add("hide");

                setTimeout(() => {
                    dropdown.style.display = "none";
                }, 300);
            }
        };

    </script>
</body>
</html>
